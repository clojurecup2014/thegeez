// Compiled by ClojureScript 0.0-2342
goog.provide('net.thegeez.datominoes.engine');
goog.require('cljs.core');
goog.require('net.thegeez.datominoes.transact');
goog.require('net.thegeez.datominoes.transact');
goog.require('datascript');
goog.require('datascript');
net.thegeez.datominoes.engine.handle = (function (){var method_table__4505__auto__ = cljs.core.atom.call(null,cljs.core.PersistentArrayMap.EMPTY);var prefer_table__4506__auto__ = cljs.core.atom.call(null,cljs.core.PersistentArrayMap.EMPTY);var method_cache__4507__auto__ = cljs.core.atom.call(null,cljs.core.PersistentArrayMap.EMPTY);var cached_hierarchy__4508__auto__ = cljs.core.atom.call(null,cljs.core.PersistentArrayMap.EMPTY);var hierarchy__4509__auto__ = cljs.core.get.call(null,cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword(null,"hierarchy","hierarchy",-1053470341),cljs.core.get_global_hierarchy.call(null));return (new cljs.core.MultiFn("handle",((function (method_table__4505__auto__,prefer_table__4506__auto__,method_cache__4507__auto__,cached_hierarchy__4508__auto__,hierarchy__4509__auto__){
return (function (event,args,report,conn){return event;
});})(method_table__4505__auto__,prefer_table__4506__auto__,method_cache__4507__auto__,cached_hierarchy__4508__auto__,hierarchy__4509__auto__))
,new cljs.core.Keyword(null,"default","default",-1987822328),hierarchy__4509__auto__,method_table__4505__auto__,prefer_table__4506__auto__,method_cache__4507__auto__,cached_hierarchy__4508__auto__));
})();
cljs.core._add_method.call(null,net.thegeez.datominoes.engine.handle,new cljs.core.Keyword(null,"game-created","game-created",-865313644),(function (event,args,report,conn){return datascript.transact_BANG_.call(null,conn,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("db.fn","call","db.fn/call",-151594418),net.thegeez.datominoes.transact.deal], null)], null));
}));
cljs.core._add_method.call(null,net.thegeez.datominoes.engine.handle,new cljs.core.Keyword(null,"deal","deal",-1166385728),(function (event,args,report,conn){return datascript.transact_BANG_.call(null,conn,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("db.fn","call","db.fn/call",-151594418),net.thegeez.datominoes.transact.assign_turn], null)], null));
}));
cljs.core._add_method.call(null,net.thegeez.datominoes.engine.handle,new cljs.core.Keyword(null,"stone-placed","stone-placed",-646989059),(function (event,args,report,conn){return datascript.transact_BANG_.call(null,conn,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("db.fn","call","db.fn/call",-151594418),net.thegeez.datominoes.transact.assign_turn], null)], null));
}));
cljs.core._add_method.call(null,net.thegeez.datominoes.engine.handle,new cljs.core.Keyword(null,"default","default",-1987822328),(function (event,args,report,conn){return cljs.core.println.call(null,"handle: ",cljs.core.pr_str.call(null,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [event,args], null)));
}));
net.thegeez.datominoes.engine.start_engine = (function start_engine(conn){datascript.listen_BANG_.call(null,conn,(function (p__41395){var map__41396 = p__41395;var map__41396__$1 = ((cljs.core.seq_QMARK_.call(null,map__41396))?cljs.core.apply.call(null,cljs.core.hash_map,map__41396):map__41396);var report = map__41396__$1;var db_after = cljs.core.get.call(null,map__41396__$1,new cljs.core.Keyword(null,"db-after","db-after",-571884666));var vec__41397 = cljs.core.first.call(null,datascript.q.call(null,new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword(null,"find","find",496279456),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?event","?event",-637781137,null),new cljs.core.Symbol(null,"?args","?args",1587951752,null)], null),new cljs.core.Keyword(null,"in","in",-1531184865),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"$","$",-1580747756,null),new cljs.core.Symbol(null,"?tx","?tx",778318308,null)], null),new cljs.core.Keyword(null,"where","where",-2044795965),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.PersistentVector(null, 4, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?e","?e",-1194391683,null),new cljs.core.Keyword(null,"event","event",301435442),new cljs.core.Symbol(null,"?event","?event",-637781137,null),new cljs.core.Symbol(null,"?tx","?tx",778318308,null)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?e","?e",-1194391683,null),new cljs.core.Keyword(null,"args","args",1315556576),new cljs.core.Symbol(null,"?args","?args",1587951752,null)], null)], null)], null),db_after,new cljs.core.Keyword(null,"max-tx","max-tx",1119558339).cljs$core$IFn$_invoke$arity$1(db_after)));var event = cljs.core.nth.call(null,vec__41397,(0),null);var args = cljs.core.nth.call(null,vec__41397,(1),null);return net.thegeez.datominoes.engine.handle.call(null,event,args,report,conn);
}));
return datascript.transact_BANG_.call(null,conn,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.PersistentVector(null, 4, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("db.fn","call","db.fn/call",-151594418),net.thegeez.datominoes.transact.create_game,"Player One","AI"], null)], null));
});
